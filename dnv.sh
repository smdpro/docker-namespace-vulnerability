#!/bin/bash

bold=$(tput bold)
normal=$(tput sgr0)
HOST_PID=1

NS_TYPES=$(lsns -p $HOST_PID |awk '{print $2}'|sed 's/TYPE//'|xargs)
HOST_NS=$(lsns -p $HOST_PID |awk '{print $1}'|sed 's/NS//'|xargs)
HOST_NS=(${HOST_NS[@]})

HEADER=("CONTAINER" "NAME" "PID" ${NS_TYPES[@]})
for i in "${HEADER[@]}"; do
   printf "%-18s" ${bold}${i}
done

CONTAINER_LIST=($HOST_PID $(docker ps |awk '{print $1}'|sed 's/CONTAINER//'|xargs))

for i in ${CONTAINER_LIST[@]}; do
        if [[ $i == $HOST_PID ]]; then
              NAME=$(hostname)
              PID=$HOST_PID
              CONTAINER='Host'
        else
              NAME=$(docker ps --format "{{.Names}} {{.ID}}"|grep ${i}|awk '{print$1}') 
              PID=$(docker inspect ${i}|grep Pid\"|awk '{print $2}'|tr ',' ' ') 
              CONTAINER=${i} 
        fi
        printf "\r%0s%-14s%-10s%-10s" ${normal} ${CONTAINER} ${NAME} ${PID}
        count=0 

        for j in ${NS_TYPES[@]}; do
          PROCESS_NS=$(lsns -p ${PID} -o NS,TYPE|grep ${j}|awk '{print $1}')
          if [[ $PROCESS_NS == "${HOST_NS[$count]}" && $PID != $HOST_PID ]]; then
              printf "\e[0;31m%0s%14s\e[m" ${bold} ${PROCESS_NS}
          else
             printf "\e[0;31m%0s%14s\e[m" ${normal} ${PROCESS_NS}
          fi
          count=$((count+1))
        done
        printf "\n" 
done
